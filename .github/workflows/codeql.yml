name: "CodeQL"

on:
  push:
    branches: [ main ]
  pull_request:
    # The branches below must be a subset of the branches above
    branches: [ main ]
  schedule:
    - cron: '32 13 * * 1'

jobs:
  analyze:
    name: Analyze
    runs-on: ubuntu-latest
    permissions:
      actions: read
      contents: read
      security-events: write

    strategy:
      fail-fast: false
      matrix:
        language: [ 'javascript' ]
        commits: ${{ github.event.commits }}

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    # Initializes the CodeQL tools for scanning.
    # - name: Initialize CodeQL
    #   uses: github/codeql-action/init@v1
    #   with:
    #     languages: ${{ matrix.language }}

    - name: send notify
      uses: louis70109/line-notify-action@master
      with:
        token: ${{ secrets.LINE_NOTIFY_TOKEN }}
        run: |
          echo ${{ toJSON(matrix.commits) }}
        message: |
          Triggered ${{github.repository}}#${{ github.ref_name }}
          [COMMIT] => ${{ matrix.commits.message }} - ${{ matrix.commits.author }}
          [ACTOR] => ${{ github.actor }}
          [***SUCCESS***]
        sticker_id: 16581271
        package_id: 8522



  run-if-failed:
    runs-on: ubuntu-latest
    needs: [analyze]
    if: failure()
    steps:
    - name: the job failure
      uses: louis70109/line-notify-action@master
      with:
        token: ${{ secrets.LINE_NOTIFY_TOKEN }}
        message: |
          Triggered ${{github.repository}}#${{ github.ref_name }}
          [COMMIT] => ${{ github.event.commits }}
          [ACTOR] => ${{ github.actor }}
          [***FAILED***]
        sticker_id: 16581283
        package_id: 8522
